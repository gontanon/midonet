# Copyright 2015 Midokura SARL
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

virtual_topology:
  description: Simple configuration with two clouds connected via router peering

  tenant_name: MMM-TEST-000-001

  routers:
    - router:
        name: left-tenant-router
        ports:
          - port:
              id: 1
              type: interior
              ipv4_addr: 172.16.1.254/24
              ipv6_addr: null
              links_to:
                  device: left-net1
                  port_id: 1

          - port:
              id: 2
              type: interior
              ipv4_addr: 192.168.250.1/24
              ipv6_addr: null
              links_to:
                  device: left-vtep-router
                  port_id: 1

        routes:
          - route:
              id: 1
              type: Normal
              src_addr: 0.0.0.0/0
              dst_addr: 172.16.1.0/24
              weight: 100
              next_hop_port: 1
              next_hop_gw: 0.0.0.0
          - route:
              id: 2
              type: Normal
              src_addr: 0.0.0.0/0
              dst_addr: 172.16.2.0/24
              weight: 100
              next_hop_port: 2
              next_hop_gw: 192.168.250.2
          - route:
              id: 3
              type: Normal
              src_addr: 0.0.0.0/0
              dst_addr: 172.16.3.0/24
              weight: 100
              next_hop_port: 2
              next_hop_gw: 192.168.250.2

    - router:
        name: left-vtep-router
        ports:
          - port:
              id: 1
              type: interior
              ipv4_addr: 169.254.111.1/32
              ipv6_addr: null
              vni: 325

          - port:
              id: 2
              type: interior
              ipv4_addr: 10.230.0.1/32
              ipv6_addr: null
              links_to:
                  device: left-provider-router
                  port_id: 1

        routes:
          - route:
              id: 1
              type: Normal
              src_addr: 0.0.0.0/0
              dst_addr: 0.0.0.0/0
              weight: 100
              next_hop_port: 2
              next_hop_gw: 169.254.10.1

    - router:
        name: left-provider-router
        ports:
          - port:
              id: 1
              type: interior
              ipv4_addr: 169.254.10.1/32
              ipv6_addr: null

          - port:
              id: 2
              type: exterior
              ipv4_addr: 10.199.201.1/24
              ipv6_addr: null

        routes:
          - route:
              id: 1
              type: Normal
              src_addr: 0.0.0.0/0
              dst_addr: 10.199.201.0/24
              weight: 100
              next_hop_port: 2
              next_hop_gw: 0.0.0.0
          - route:
              id: 2
              type: Normal
              src_addr: 0.0.0.0/0
              dst_addr: 10.230.0.1/32
              weight: 100
              next_hop_port: 1
              next_hop_gw: 0.0.0.0

    - router:
        name: right-tenant-router
        ports:
          - port:
              id: 1
              type: interior
              ipv4_addr: 172.16.2.254/24
              ipv6_addr: null
              links_to:
                  device: right-net2
                  port_id: 1

          - port:
              id: 2
              type: interior
              ipv4_addr: 172.16.3.254/24
              ipv6_addr: null
              links_to:
                  device: right-net3
                  port_id: 1

          - port:
              id: 3
              type: interior
              ipv4_addr: 192.168.250.2/24
              ipv6_addr: null
              links_to:
                  device: right-vtep-router
                  port_id: 1

        routes:
          - route:
              id: 1
              type: Normal
              src_addr: 0.0.0.0/0
              dst_addr: 172.16.2.0/24
              weight: 100
              next_hop_port: 1
              next_hop_gw: 0.0.0.0
          - route:
              id: 1
              type: Normal
              src_addr: 0.0.0.0/0
              dst_addr: 172.16.3.0/24
              weight: 100
              next_hop_port: 2
              next_hop_gw: 0.0.0.0
          - route:
              id: 3
              type: Normal
              src_addr: 0.0.0.0/0
              dst_addr: 172.16.1.0/24
              weight: 100
              next_hop_port: 3
              next_hop_gw: 192.168.250.1

    - router:
        name: right-vtep-router
        ports:
          - port:
              id: 1
              type: interior
              ipv4_addr: 169.254.111.1/32
              ipv6_addr: null
              vni: 325

          - port:
              id: 2
              type: interior
              ipv4_addr: 10.230.0.2/32
              ipv6_addr: null
              links_to:
                  device: right-provider-router
                  port_id: 1

        routes:
          - route:
              id: 1
              type: Normal
              src_addr: 0.0.0.0/0
              dst_addr: 0.0.0.0/0
              weight: 100
              next_hop_port: 2
              next_hop_gw: 169.254.10.1

    - router:
        name: right-provider-router
        ports:
          - port:
              id: 1
              type: interior
              ipv4_addr: 169.254.10.1/32
              ipv6_addr: null

          - port:
              id: 2
              type: exterior
              ipv4_addr: 10.199.201.2/24
              ipv6_addr: null

        routes:
          - route:
              id: 1
              type: Normal
              src_addr: 0.0.0.0/0
              dst_addr: 10.199.201.0/24
              weight: 100
              next_hop_port: 2
              next_hop_gw: 0.0.0.0
          - route:
              id: 2
              type: Normal
              src_addr: 0.0.0.0/0
              dst_addr: 10.230.0.2/32
              weight: 100
              next_hop_port: 1
              next_hop_gw: 0.0.0.0

  bridges:
    - bridge:
        name: left-net1
        ports:
          - port:
              id: 1
              type: interior
          - port:
              id: 2
              type: exterior

    - bridge:
        name: right-net2
        ports:
          - port:
              id: 1
              type: interior
          - port:
              id: 2
              type: exterior

    - bridge:
        name: right-net3
        ports:
          - port:
              id: 1
              type: interior
          - port:
              id: 2
              type: exterior
